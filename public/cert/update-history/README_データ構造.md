# 問題集 修正履歴 - データ構造ガイド

このドキュメントは、問題集の修正履歴を管理するためのデータ構造と、AIが更新作業を行う際の手順を説明します。

---

## ディレクトリ構造

```
update-history/
├── index.html              # 表示用HTML
├── style.css               # スタイルシート
├── index.json              # メタデータ（月一覧のみ）
├── README_データ構造.md     # このファイル
└── data/
    ├── 2025-11.jsonl       # 2025年11月のデータ（JSONL形式）
    ├── 2025-12.jsonl       # 2025年12月のデータ（例）
    └── ...                 # 月ごとに増加
```

---

## ファイル形式

### index.json（メタデータ）

**役割**: 存在する月ファイルの一覧を管理（totalは不要、JSで動的計算）

```json
{
  "months": ["2025-11", "2025-10"]
}
```

| フィールド | 説明 |
|-----------|------|
| `months` | 存在する月ファイルの一覧（新しい順） |

### data/YYYY-MM.jsonl（月別データ・JSONL形式）

**役割**: 各月の修正履歴を格納（1行1レコード）

```jsonl
{"date":"2025-11-27","id":"SAP-195","exam":"SAP","summary":"正解の設定と解説の対応を修正しました。"}
{"date":"2025-11-27","id":"SAP-44","exam":"SAP","summary":"図解の内容を問題に合わせて修正しました。"}
{"date":"2025-11-26","id":"SOA-221","exam":"SOA","summary":"解説の記載順序を修正しました。"}
```

| フィールド | 説明 |
|-----------|------|
| `date` | 修正日（YYYY-MM-DD形式） |
| `id` | 問題ID（例: SAP-44, SAA-13） |
| `exam` | 試験区分（SAP, SAA, SOA, SCS, DVA, ANS, DOP, AIF, DEA, MLA, MLS） |
| `summary` | 修正内容の要約（日本語） |

---

## AI向け: 更新作業フロー（コスト最適化版）

### 🚀 追記のみ（ファイル読み込み不要！）

修正履歴を追加する場合、**ファイルを読み込まずに末尾に1行追加するだけ**でOKです。

```bash
echo '{"date":"2025-11-27","id":"SAP-195","exam":"SAP","summary":"正解の設定を修正しました。"}' >> /path/to/data/2025-11.jsonl
```

### コスト比較

| 方式 | 読み込み | 書き込み | 1回あたり |
|------|---------|---------|----------|
| **旧方式（JSON）** | 全体読込 | 全体書込 | 約5円 |
| **新方式（JSONL追記）** | 0 | 1行のみ | **約0.1円** |

---

## 具体的な手順

### 1. 当月のファイルに追記（通常ケース）

```bash
# ターミナルコマンドで追記（ファイル読み込み不要）
echo '{"date":"2025-11-27","id":"SAA-100","exam":"SAA","summary":"解説の記載順序を修正しました。"}' >> /Users/blackriver/Library/CloudStorage/GoogleDrive-kurokawa@cloudhuck.com/マイドライブ/AI\ Managed/public/cert/update-history/data/2025-11.jsonl
```

### 2. 新しい月のファイルを作成する場合

1. 新しいJSONLファイルを作成

```bash
echo '{"date":"2025-12-01","id":"SAA-100","exam":"SAA","summary":"解説の記載順序を修正しました。"}' > /path/to/data/2025-12.jsonl
```

2. index.json の months 配列に追加

```json
{
  "months": ["2025-12", "2025-11"]
}
```

### 3. 複数件を同時に追加する場合

```bash
echo '{"date":"2025-11-27","id":"SAP-100","exam":"SAP","summary":"修正1"}
{"date":"2025-11-27","id":"SAA-50","exam":"SAA","summary":"修正2"}' >> /path/to/data/2025-11.jsonl
```

---

## 注意事項

1. **JSONLは1行1レコード**
   - 各行が独立したJSONオブジェクト
   - 行末に改行が必要
   - 配列の `[]` や カンマ `,` は不要

2. **日付形式は統一**
   - 日付: `YYYY-MM-DD`（例: 2025-11-27）
   - 月: `YYYY-MM`（例: 2025-11）

3. **exam フィールドの値**
   - 大文字で統一: `SAP`, `SAA`, `SOA`, `SCS`, `DVA`, `ANS`, `DOP`, `AIF`, `DEA`, `MLA`, `MLS`

4. **追記時はechoコマンドを使用**
   - `>>` で末尾に追記（上書きではない）
   - ファイル読み込みが不要なのでコスト削減

---

## index.html の動作

1. `index.json` を読み込み、月一覧を取得
2. 各月の `data/YYYY-MM.jsonl` を並列で読み込み
3. 各行をJSONとしてパース
4. 全データを結合して日付順にソート
5. totalは動的に計算して表示

---

## 例: 今日（2025-12-15）に SAA-200 の修正を記録する

### 当月ファイルが存在する場合

```bash
echo '{"date":"2025-12-15","id":"SAA-200","exam":"SAA","summary":"解説の記載順序を修正しました。"}' >> /path/to/data/2025-12.jsonl
```

### 当月ファイルが存在しない場合（新しい月）

```bash
# 1. 新規ファイル作成
echo '{"date":"2025-12-15","id":"SAA-200","exam":"SAA","summary":"解説の記載順序を修正しました。"}' > /path/to/data/2025-12.jsonl

# 2. index.json を更新（months配列の先頭に追加）
```

---

## トラブルシューティング

### JSONLのパースエラー

- 各行が有効なJSONか確認
- 行末に余分な文字（カンマなど）がないか確認
- 空行がないか確認

### 表示されない

- index.json の months に月が含まれているか確認
- ファイル名が `YYYY-MM.jsonl` 形式か確認
